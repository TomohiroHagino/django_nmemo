# 画像削除機能のテスト手順

## 正しいテスト手順

### 1. 画像を含むページを作成

1. 新しいページを作成
2. エディタに何かテキストを入力（例：「テスト画像」）
3. 画像挿入ボタン（📷）をクリックして画像をアップロード
4. **画像がエディタに表示されることを確認**
5. 💾 保存ボタンをクリック
6. 保存が完了するまで待つ

### 2. 画像を削除

1. 同じページを開く
2. **エディタに画像が表示されていることを確認**
3. 画像を選択してDeleteキーで削除、または画像をクリックしてBackspaceキーで削除
4. **画像がエディタから消えたことを確認**
5. 💾 保存ボタンをクリック

### 3. 結果確認

サーバーコンソールに以下のような出力が表示されるはずです：

```
DEBUG: update_page called for page X
DEBUG: Old content length: XXX
DEBUG: Old content preview: <p>テスト画像</p><p><img src="/media/uploads/page_X/xxxxx.png"></p>
DEBUG: New content preview: <p>テスト画像</p><p><br></p>
DEBUG: Old images: {'/media/uploads/page_X/xxxxx.png'}
DEBUG: New images: set()
DEBUG: Removed images: {'/media/uploads/page_X/xxxxx.png'}
✓ Deleted removed image: /path/to/file
```

## 現在の問題

あなたのテストケースでは：
- Old content: `<p><br></p>...` （画像なし）
- New content: `<p><br></p>...` （画像なし）

これは以下のいずれかの問題です：

### 可能性1: 画像アップロード後に保存していない

画像をアップロードしただけで、その画像を含むコンテンツを一度も保存していない場合、データベースには空のコンテンツのままです。

**解決策**: 
- 画像をアップロードした後、必ず一度保存してください
- その後、画像を削除して再度保存してください

### 可能性2: 画像がエディタに挿入されていない

画像アップロードは成功しているが、Quillエディタに実際に挿入されていない可能性があります。

**確認方法**:
- 画像アップロード後、エディタ内に画像が表示されているか確認
- ブラウザの開発者ツール（F12）→ Console タブでエラーがないか確認

### 可能性3: カーソル位置の問題

`<span class="ql-cursor">` が含まれているので、Quillの内部カーソル要素が残っています。これは通常問題ありませんが、画像が正しく挿入されていない可能性があります。

## 推奨テスト手順（詳細版）

1. **ページを新規作成**
   ```
   タイトル: 画像削除テスト
   コンテンツ: これは画像削除のテストです
   ```

2. **画像を追加**
   - エディタ内にカーソルを置く
   - 画像挿入ボタンをクリック
   - 画像ファイルを選択
   - **エディタ内に画像が表示されることを確認** ← これが重要！

3. **保存**
   - 💾 保存ボタンをクリック
   - 「保存しました ✓」が表示されるまで待つ

4. **ページをリロード**（F5キー）
   - 画像がまだ表示されているか確認

5. **画像を削除**
   - 画像をクリックして選択
   - Deleteキーを押す
   - 画像が消えることを確認

6. **保存**
   - 💾 保存ボタンをクリック

7. **サーバーコンソールを確認**
   - 削除のメッセージが表示されているか確認


